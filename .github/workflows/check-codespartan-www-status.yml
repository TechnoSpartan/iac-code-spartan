name: Check CodeSpartan WWW Status

on:
  workflow_dispatch:

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Verificar estado del contenedor
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.VPS_SSH_HOST }}
          username: ${{ secrets.VPS_SSH_USER }}
          key: ${{ secrets.VPS_SSH_KEY }}
          script: |
            echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
            echo "üîç ESTADO CODESPARTAN WWW"
            echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
            
            echo ""
            echo "1Ô∏è‚É£ Estado del contenedor:"
            docker ps -a --filter "name=codespartan-www" --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
            
            echo ""
            echo "2Ô∏è‚É£ Logs completos (√∫ltimos 100 l√≠neas):"
            docker logs codespartan-www --tail 100 2>&1 || echo "No hay logs disponibles"
            
            echo ""
            echo "3Ô∏è‚É£ Verificar si el proceso est√° corriendo:"
            docker exec codespartan-www ps aux 2>&1 | head -10 || echo "No se puede ejecutar ps (container puede estar detenido)"
            
            echo ""
            echo "4Ô∏è‚É£ Verificar si server.js existe:"
            docker exec codespartan-www ls -la /app/ 2>&1 | head -20 || echo "No se puede listar (container puede estar detenido)"
            
            echo ""
            echo "5Ô∏è‚É£ Test de conectividad interna (puerto 3000):"
            docker exec codespartan-www wget -qO- --timeout=3 http://localhost:3000/health 2>&1 || echo "No se puede conectar"
            
            echo ""
            echo "6Ô∏è‚É£ Verificar imagen descargada:"
            docker images | grep codespartan-www

